<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>gorm自动创建database &mdash; 阿嫂</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/css/components/collection.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/css/components/repo-card.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/css/sections/repo-list.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/css/components/boxed-group.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/css/globals/common.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/css/globals/responsive.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/css/posts/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/rouge-themes@master/dist/github.css"><link rel="canonical" href="https://lewinz.org/2021/05/05/go-gorm-ddl/"><link rel="alternate" type="application/atom+xml" title="阿嫂" href="https://lewinz.org/feed.xml"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/favicon.ico"><meta property="og:title" content="gorm自动创建database"><meta name="keywords" content="gorm"><meta name="og:keywords" content="gorm"><meta name="description" content="gorm自动创建database"><meta name="og:description" content="gorm自动创建database"><meta property="og:url" content="https://lewinz.org/2021/05/05/go-gorm-ddl/"><meta property="og:site_name" content="阿嫂"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2021-05-05"> <script src="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/js/jquery-ui.js"></script> <script src="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/js/main.js"></script> <script data-ad-client="ca-pub-7093222719567591" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1><a href="https://lewinz.org/" title="阿嫂"><span class="octicon octicon-mark-github"></span> 阿嫂</a></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="https://lewinz.org/" class=" site-header-nav-item" target="" title="首页">首页</a> <a href="https://lewinz.org/categories/" class=" site-header-nav-item" target="" title="分类">分类</a> <a href="https://lewinz.org/wiki/" class=" site-header-nav-item" target="" title="维基">维基</a> <a href="https://lewinz.org/links/" class=" site-header-nav-item" target="" title="链接">链接</a> <a href="https://lewinz.org/about/" class=" site-header-nav-item" target="" title="关于">关于</a></nav></div></header><section class="collection-head small geopattern" data-pattern-id="gorm自动创建databas"><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">gorm自动创建database</h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2021/05/05 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://lewinz.org/categories/#gorm" title="gorm">gorm</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 4056 字，约 12 分钟 </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths" > <ins class="adsbygoogle content-header-ad" data-ad-client="ca-pub-7093222719567591" data-ad-slot="1650902835"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> <br /><article class="article-content markdown-body"><h2 id="gorm自动创建database">gorm自动创建database</h2><h3 id="tag约定">tag约定</h3><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">示例</span><span class="err">：</span>
<span class="k">type</span> <span class="n">Post</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">PostId</span>    <span class="kt">int</span>    <span class="s">`gorm:"primary_key;auto_increment"`</span>
    <span class="n">Uid</span>       <span class="kt">int</span>    <span class="s">`gorm:"type:int;not null"`</span>
    <span class="n">Title</span>     <span class="kt">string</span> <span class="s">`gorm:"type:varchar(255);not null"`</span>
    <span class="n">Content</span>   <span class="kt">string</span> <span class="s">`gorm:"type:text;not null"`</span>
    <span class="n">Type</span>      <span class="kt">uint8</span>  <span class="s">`gorm:"type:tinyint;default 1;not null"`</span>
    <span class="n">CreatedAt</span> <span class="n">time</span><span class="o">.</span><span class="n">Time</span>
    <span class="n">UpdatedAt</span> <span class="n">time</span><span class="o">.</span><span class="n">Time</span>
    <span class="n">DeletedAt</span> <span class="n">time</span><span class="o">.</span><span class="n">Time</span>
<span class="p">}</span>

<span class="n">column</span>	<span class="n">指定列名</span>
<span class="k">type</span>	<span class="n">指定列数据类型</span>
<span class="n">size</span>	<span class="n">指定列大小</span><span class="p">,</span> <span class="n">默认值255</span>
<span class="n">primary_key</span>	<span class="n">将列指定为主键</span>
<span class="n">unique</span>	<span class="n">将列指定为唯一</span>
<span class="k">default</span>	<span class="n">指定列默认值</span>
<span class="n">precision</span>   <span class="n">指定列精度</span>
<span class="n">not</span> <span class="n">null</span>    <span class="n">将列指定为非</span> <span class="n">null</span>
<span class="n">auto_increment</span>  <span class="n">指定列是否为自增类型</span>
<span class="n">index</span>   <span class="n">创建具有或不带名称的索引</span><span class="p">,</span> <span class="n">如果多个索引同名则创建复合索引</span>
<span class="n">unique_index</span>    <span class="n">和</span> <span class="n">index</span> <span class="n">类似</span><span class="err">，</span><span class="n">只不过创建的是唯一索引</span>
<span class="n">embedded</span>    <span class="n">将结构设置为嵌入</span>
<span class="n">embedded_prefix</span> <span class="n">设置嵌入结构的前缀</span>
<span class="o">-</span>   <span class="n">忽略此字段</span>
</code></pre></div></div><h4 id="主键">主键</h4><p>grom的约定中，一般将数据模型中的id字段映射为数据表的主键，如下面定义的testmodel,id为主键，testmodel的id的数据类型为string，如果id的数据类型为int，则grom还会为该设置auto_increment，使用id成为自增主键。</p><p>示例：</p><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">TestModel</span> <span class="k">struct</span><span class="p">{</span>
    <span class="n">ID</span>   <span class="kt">int</span>
    <span class="n">Name</span> <span class="kt">string</span>
<span class="p">}</span>
</code></pre></div></div><p>当然，我们也可以自定义主键字段的名称，示例的Post结构体，我们设置了PostId字段为主键，如果我们定义了其他字段为主键，那么，就算结构体中仍有ID字段，GROM框架也不会把ID字段当作主键了。</p><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">Post</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">ID</span>        <span class="kt">int</span>
    <span class="n">PostId</span>    <span class="kt">int</span>    <span class="s">`gorm:"primary_key;auto_increment"`</span>
    <span class="n">Uid</span>       <span class="kt">int</span>    <span class="s">`gorm:"type:int;not null"`</span>
    <span class="n">Title</span>     <span class="kt">string</span> <span class="s">`gorm:"type:varchar(255);not null"`</span>
    <span class="n">Content</span>   <span class="kt">string</span> <span class="s">`gorm:"type:text;not null"`</span>
    <span class="n">Type</span>      <span class="kt">uint8</span>  <span class="s">`gorm:"type:tinyint;default 1;not null"`</span>
    <span class="n">CreatedAt</span> <span class="n">time</span><span class="o">.</span><span class="n">Time</span>
    <span class="n">UpdatedAt</span> <span class="n">time</span><span class="o">.</span><span class="n">Time</span>
    <span class="n">DeletedAt</span> <span class="n">time</span><span class="o">.</span><span class="n">Time</span>
<span class="p">}</span>
</code></pre></div></div><h4 id="数据表映射规则">数据表映射规则</h4><p>当我们使用结构体创建数据表时，数据表的名称默认为结构体的小写复数形式，如结构体Post对应的数据表名称为posts,当然我们也可以自己指定结构体对应的数据表名称，而不是用默认的。</p><p>为结构体加上TableName()方法，通过这个方法可以返回自定义的数据表名，如下：</p><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">//指定Post结构体对应的数据表为my_posts</span>
<span class="k">func</span> <span class="p">(</span><span class="n">p</span> <span class="n">Post</span><span class="p">)</span> <span class="n">TableName</span><span class="p">()</span> <span class="kt">string</span><span class="p">{</span>
    <span class="k">return</span> <span class="s">"my_posts"</span>
<span class="p">}</span>
</code></pre></div></div><h4 id="数据表前缀全局">数据表前缀（全局）</h4><p>除了指定数据表名外，我们也可以重写gorm.DefaultTableNameHandler这个变量，这样可以为所有数据表指定统一的数据表前缀，如下：</p><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gorm</span><span class="o">.</span><span class="n">DefaultTableNameHandler</span> <span class="o">=</span> <span class="k">func</span> <span class="p">(</span><span class="n">db</span> <span class="o">*</span><span class="n">gorm</span><span class="o">.</span><span class="n">DB</span><span class="p">,</span> <span class="n">defaultTableName</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span>  <span class="p">{</span>
    <span class="k">return</span> <span class="s">"tb_"</span> <span class="o">+</span> <span class="n">defaultTableName</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><h4 id="字段映射规则">字段映射规则</h4><p>结构体到数据表的名称映射规则为结构体名称的复数，而结构体的字段到数据表字段的默认映射规则是用下划线分隔每个大写字母开头的单词，如下：</p><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">Prize</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">ID</span> <span class="kt">int</span>
	<span class="n">PrizeName</span> <span class="kt">string</span>
<span class="p">}</span>
</code></pre></div></div><p>上面的结构体Prize中的PrizeName字段对应的数据表为prize_name，但我们把PrizeName改为Prizename时，则对应的数据表字段名称为prizename,这是为因为只分隔大写字段开头的单词。</p><p>当然，我们也可以为结构体的某个字段定义tags扩展信息,这样结构体字段到数据表字段的映规则就在tags中定义。</p><h4 id="时间点追踪">时间点追踪</h4><p>前面我们说过，如果结构体中有名称为ID字段，则GORM框架会把该字段作为数据表的主键，除此之外，如果结构体中有CreatedAt,UpdatedAt,DeletedAt这几个字段的话，则GROM框架也会作一些特殊处理，规则如下：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CreatedAt：新增数据表记录的时候，会自动写入这个字段。
UpdatedAt：更新数据表记录的时候，会自动更新这个字段。
DeletedAt：当执行软删除的时候，会自动更新这个字段，表示删除时间
</code></pre></div></div><h4 id="gormmodel">gorm.Model</h4><p>由于如果结构体中有ID,CreatedAt,UpdatedAt,DeletedAt这几个比较通用的字段，GORM框架会自动处理这几个字段，所以如果我们结构体需要这几个字段时，我们可以直接在自定义结构体中嵌入gorm.Model结构体，gorm.Model的结构体如下：</p><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">Model</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">ID</span>        <span class="kt">uint</span> <span class="s">`gorm:"primary_key"`</span>
    <span class="n">CreatedAt</span> <span class="n">time</span><span class="o">.</span><span class="n">Time</span>
    <span class="n">UpdatedAt</span> <span class="n">time</span><span class="o">.</span><span class="n">Time</span>
    <span class="n">DeletedAt</span> <span class="o">*</span><span class="n">time</span><span class="o">.</span><span class="n">Time</span> <span class="s">`sql:"index"`</span>
<span class="p">}</span>
</code></pre></div></div><p>所以，如果我们在结构体Prize中嵌入gorm.Model,如下：</p><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">Prize</span> <span class="k">struct</span><span class="p">{</span>
    <span class="n">gorm</span><span class="o">.</span><span class="n">Model</span>
    <span class="n">Name</span> <span class="kt">string</span>
<span class="p">}</span>
</code></pre></div></div><p>这样就等同于：</p><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">Prize</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">ID</span>        <span class="kt">uint</span> <span class="s">`gorm:"primary_key"`</span>
	<span class="n">Name</span>      <span class="kt">string</span>
	<span class="n">CreatedAt</span> <span class="n">time</span><span class="o">.</span><span class="n">Time</span>
	<span class="n">UpdatedAt</span> <span class="n">time</span><span class="o">.</span><span class="n">Time</span>
	<span class="n">DeletedAt</span> <span class="o">*</span><span class="n">time</span><span class="o">.</span><span class="n">Time</span> <span class="s">`sql:"index"`</span>
<span class="p">}</span>
</code></pre></div></div><h3 id="数据库迁移">数据库迁移</h3><p>我们这里所说的数据库迁移，即通过使用GROM提供的一系列方法，根据数据模型定义好的规则，进行创建、删除数据表等操作，也就是数据库的DDL操作。</p><p>GORM提供对数据库进行DDL操作的方法，主要以下几类：</p><h4 id="数据表操作">数据表操作</h4><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">//根据模型自动创建数据表</span>
<span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span><span class="n">DB</span><span class="p">)</span> <span class="n">AutoMigrate</span><span class="p">(</span><span class="n">values</span> <span class="o">...</span><span class="k">interface</span><span class="p">{})</span> <span class="o">*</span><span class="n">DB</span> 
 
<span class="c">//根据模型创建数据表</span>
<span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span><span class="n">DB</span><span class="p">)</span> <span class="n">CreateTable</span><span class="p">(</span><span class="n">models</span> <span class="o">...</span><span class="k">interface</span><span class="p">{})</span> <span class="o">*</span><span class="n">DB</span>
 
<span class="c">//删除数据表，相当于drop table语句</span>
<span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span><span class="n">DB</span><span class="p">)</span> <span class="n">DropTable</span><span class="p">(</span><span class="n">values</span> <span class="o">...</span><span class="k">interface</span><span class="p">{})</span> <span class="o">*</span><span class="n">DB</span> 
 
<span class="c">//相当于drop table if exsist 语句</span>
<span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span><span class="n">DB</span><span class="p">)</span> <span class="n">DropTableIfExists</span><span class="p">(</span><span class="n">values</span> <span class="o">...</span><span class="k">interface</span><span class="p">{})</span> <span class="o">*</span><span class="n">DB</span> 
 
<span class="c">//根据模型判断数据表是否存在</span>
<span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span><span class="n">DB</span><span class="p">)</span> <span class="n">HasTable</span><span class="p">(</span><span class="n">value</span> <span class="k">interface</span><span class="p">{})</span> <span class="kt">bool</span>
</code></pre></div></div><h4 id="列操作">列操作</h4><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">//删除数据表字段</span>
<span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span><span class="n">DB</span><span class="p">)</span> <span class="n">DropColumn</span><span class="p">(</span><span class="n">column</span> <span class="kt">string</span><span class="p">)</span> <span class="o">*</span><span class="n">DB</span>
 
<span class="c">//修改数据表字段的数据类型</span>
<span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span><span class="n">DB</span><span class="p">)</span> <span class="n">ModifyColumn</span><span class="p">(</span><span class="n">column</span> <span class="kt">string</span><span class="p">,</span> <span class="n">typ</span> <span class="kt">string</span><span class="p">)</span> <span class="o">*</span><span class="n">DB</span>
</code></pre></div></div><h4 id="索引操作">索引操作</h4><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">//添加外键</span>
<span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span><span class="n">DB</span><span class="p">)</span> <span class="n">AddForeignKey</span><span class="p">(</span><span class="n">field</span> <span class="kt">string</span><span class="p">,</span> <span class="n">dest</span> <span class="kt">string</span><span class="p">,</span> <span class="n">onDelete</span> <span class="kt">string</span><span class="p">,</span> <span class="n">onUpdate</span> <span class="kt">string</span><span class="p">)</span> <span class="o">*</span><span class="n">DB</span>
 
<span class="c">//给数据表字段添加索引</span>
<span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span><span class="n">DB</span><span class="p">)</span> <span class="n">AddIndex</span><span class="p">(</span><span class="n">indexName</span> <span class="kt">string</span><span class="p">,</span> <span class="n">columns</span> <span class="o">...</span><span class="kt">string</span><span class="p">)</span> <span class="o">*</span><span class="n">DB</span>
 
<span class="c">//给数据表字段添加唯一索引</span>
<span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span><span class="n">DB</span><span class="p">)</span> <span class="n">AddUniqueIndex</span><span class="p">(</span><span class="n">indexName</span> <span class="kt">string</span><span class="p">,</span> <span class="n">columns</span> <span class="o">...</span><span class="kt">string</span><span class="p">)</span> <span class="o">*</span><span class="n">DB</span>
</code></pre></div></div><h3 id="数据迁移简单代码示例">数据迁移简单代码示例</h3><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">User</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">Id</span>       <span class="kt">int</span>   <span class="c">//对应数据表的自增id</span>
    <span class="n">Username</span> <span class="kt">string</span>
    <span class="n">Password</span> <span class="kt">string</span>
    <span class="n">Email</span>    <span class="kt">string</span>
    <span class="n">Phone</span>    <span class="kt">string</span>
<span class="p">}</span>
 
<span class="k">func</span> <span class="n">main</span><span class="p">(){</span>
    <span class="n">db</span><span class="o">.</span><span class="n">AutoMigrate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Post</span><span class="p">{},</span><span class="o">&amp;</span><span class="n">User</span><span class="p">{})</span><span class="c">//创建posts和users数据表</span>
 
    <span class="n">db</span><span class="o">.</span><span class="n">CreateTable</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Post</span><span class="p">{})</span><span class="c">//创建posts数据表</span>
    
    <span class="n">db</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="s">"gorm:table_options"</span><span class="p">,</span> <span class="s">"ENGINE=InnoDB"</span><span class="p">)</span><span class="o">.</span><span class="n">CreateTable</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Post</span><span class="p">{})</span><span class="c">//创建posts表时指存在引擎</span>
    
    <span class="n">db</span><span class="o">.</span><span class="n">DropTable</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Post</span><span class="p">{},</span><span class="s">"users"</span><span class="p">)</span><span class="c">//删除posts和users表数据表</span>
    
    <span class="n">db</span><span class="o">.</span><span class="n">DropTableIfExists</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Post</span><span class="p">{},</span><span class="s">"users"</span><span class="p">)</span><span class="c">//删除前会判断posts和users表是否存在</span>
    
    <span class="c">//先判断users表是否存在，再删除users表</span>
    <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">HasTable</span><span class="p">(</span><span class="s">"users"</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">db</span><span class="o">.</span><span class="n">DropTable</span><span class="p">(</span><span class="s">"users"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="c">//删除数据表字段</span>
    <span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Post</span><span class="p">{})</span><span class="o">.</span><span class="n">DropColumn</span><span class="p">(</span><span class="s">"id"</span><span class="p">)</span>
    
    <span class="c">//修改字段数据类型</span>
    <span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Post</span><span class="p">{})</span><span class="o">.</span><span class="n">ModifyColumn</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span><span class="s">"varchar(255)"</span><span class="p">)</span>
    
    <span class="c">//建立posts与users表之间的外键关联</span>
    <span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Post</span><span class="p">{})</span><span class="o">.</span><span class="n">AddForeignKey</span><span class="p">(</span><span class="s">"uid"</span><span class="p">,</span> <span class="s">"users(id)"</span><span class="p">,</span> <span class="s">"RESTRICT"</span><span class="p">,</span> <span class="s">"RESTRICT"</span><span class="p">)</span>
    
    <span class="c">//给posts表的title字段添加索引</span>
    <span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Post</span><span class="p">{})</span><span class="o">.</span><span class="n">AddIndex</span><span class="p">(</span><span class="s">"index_title"</span><span class="p">,</span><span class="s">"title"</span><span class="p">)</span>
    
    <span class="c">//给users表的phone字段添加唯一索引</span>
    <span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="o">&amp;</span><span class="n">User</span><span class="p">{})</span><span class="o">.</span><span class="n">AddUniqueIndex</span><span class="p">(</span><span class="s">"index_phone"</span><span class="p">,</span><span class="s">"phone"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div><div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"><h3>文档信息</h3><ul><li>本文作者：<a href="https://lewinz.org" target="_blank">Lewin</a></li><li>本文链接：<a href="https://lewinz.org/2021/05/05/go-gorm-ddl/" target="_blank">https://lewinz.org/2021/05/05/go-gorm-ddl/</a></li><li>版权声明：自由转载-非商用-非衍生-保持署名</li></ul></div></article><div class="share"></div><div class="comment"><div id="gitalk-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/vendor/gitalk/gitalk.css"> <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> <script> var gitalk = new Gitalk({ id: '/2021/05/05/go-gorm-ddl/', clientID: '3e7199ec0cac88c1d311', clientSecret: '55eef1180649f1417aa979dc9f50f66ed4a6e69a', repo: 'blog-comments', owner: 'Lewinz', admin: ['Lewinz'], labels: ['gitment'], perPage: 50, }); gitalk.render('gitalk-container'); </script></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width:96%" type="text" id="search_box" placeholder="Search"></div><ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul><script src="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: 'https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@built/assets/search_data.json?v=1625105473', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 10, fuzzy: false, exclude: ['Welcome'] }) </script><h3 class="post-directory-title mobile-hidden">Table of Contents</h3><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/js/jquery.toc.js"></script></div></div></section><footer class="container"> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7093222719567591" data-ad-slot="5263168187" data-ad-format="auto" data-full-width-responsive="true"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2021 <span title="Lewin">Lewin</span> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo(0,0)" >TOP</a></li></ul><a href="https://github.com/Lewinz/lewinz.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="https://lewinz.org/" title="首页" target="">首页</a></li><li> <a href="https://lewinz.org/categories/" title="分类" target="">分类</a></li><li> <a href="https://lewinz.org/wiki/" title="维基" target="">维基</a></li><li> <a href="https://lewinz.org/links/" title="链接" target="">链接</a></li><li> <a href="https://lewinz.org/about/" title="关于" target="">关于</a></li><li><a href="https://lewinz.org/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul><script async src="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/vendor/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="mobile-hidden" style="margin-top:8px"> <span id="busuanzi_container_site_pv" style="display:none"> 本站访问量<span id="busuanzi_value_site_pv"></span>次 </span> <span id="busuanzi_container_site_uv" style="display:none"> / 本站访客数<span id="busuanzi_value_site_uv"></span>人 </span> <span id="busuanzi_container_page_pv" style="display:none"> / 本页访问量<span id="busuanzi_value_page_pv"></span>次 / 统计始于2021-04-21 </span></div></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a></div><script src="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script><div style="display:none"> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-80669434-1', 'auto'); ga('send', 'pageview'); </script></div></body></html>
