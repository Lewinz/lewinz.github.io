<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>Golang 基础包 &mdash; 阿嫂</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/css/components/collection.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/css/components/repo-card.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/css/sections/repo-list.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/css/components/boxed-group.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/css/globals/common.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/css/globals/responsive.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/css/posts/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/rouge-themes@master/dist/github.css"><link rel="canonical" href="https://lewinz.org/2021/06/24/golang-basic-package/"><link rel="alternate" type="application/atom+xml" title="阿嫂" href="https://lewinz.org/feed.xml"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/favicon.ico"><meta property="og:title" content="Golang 基础包"><meta name="keywords" content="golang,基础包"><meta name="og:keywords" content="golang,基础包"><meta name="description" content="time"><meta name="og:description" content="time"><meta property="og:url" content="https://lewinz.org/2021/06/24/golang-basic-package/"><meta property="og:site_name" content="阿嫂"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2021-06-24"> <script src="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/js/jquery-ui.js"></script> <script src="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/js/main.js"></script> <script data-ad-client="ca-pub-7093222719567591" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1><a href="https://lewinz.org/" title="阿嫂"><span class="octicon octicon-mark-github"></span> 阿嫂</a></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="https://lewinz.org/" class=" site-header-nav-item" target="" title="首页">首页</a> <a href="https://lewinz.org/categories/" class=" site-header-nav-item" target="" title="分类">分类</a> <a href="https://lewinz.org/wiki/" class=" site-header-nav-item" target="" title="维基">维基</a> <a href="https://lewinz.org/links/" class=" site-header-nav-item" target="" title="链接">链接</a> <a href="https://lewinz.org/about/" class=" site-header-nav-item" target="" title="关于">关于</a></nav></div></header><section class="collection-head small geopattern" data-pattern-id="Golang 基础包"><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">Golang 基础包</h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2021/06/24 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://lewinz.org/categories/#golang" title="golang">golang</a> </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://lewinz.org/categories/#基础包" title="基础包">基础包</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 5624 字，约 17 分钟 </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths" > <ins class="adsbygoogle content-header-ad" data-ad-client="ca-pub-7093222719567591" data-ad-slot="1650902835"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> <br /><article class="article-content markdown-body"><h2 id="time">time</h2><p>golang 时间可分为时间点和时间段</p><ul><li>时间点 (Time)</li><li>时间段 (Duration)</li></ul><p>除此之外，还提供了其他几种类型</p><ul><li>时区 (Location)</li><li>Ticker</li><li>Timer (定时器)</li></ul><h3 id="时间点-time">时间点 (Time)</h3><h4 id="初始化">初始化</h4><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// func Now() Time</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">())</span>

<span class="c">// func Parse(layout, value string) (Time, error)</span>
<span class="n">time</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="s">"2016-01-02 15:04:05"</span><span class="p">,</span> <span class="s">"2018-04-23 12:24:51"</span><span class="p">)</span>

<span class="c">// func ParseInLocation(layout, value string, loc *Location) (Time, error) (layout已带时区时可直接用Parse)</span>
<span class="n">time</span><span class="o">.</span><span class="n">ParseInLocation</span><span class="p">(</span><span class="s">"2006-01-02 15:04:05"</span><span class="p">,</span> <span class="s">"2017-05-11 14:06:06"</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">Local</span><span class="p">)</span>

<span class="c">// func Unix(sec int64, nsec int64) Time</span>
<span class="n">time</span><span class="o">.</span><span class="n">Unix</span><span class="p">(</span><span class="m">1e9</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>

<span class="c">// func Date(year int, month Month, day, hour, min, sec, nsec int, loc *Location) Time</span>
<span class="n">time</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="m">2018</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">15</span><span class="p">,</span> <span class="m">30</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">Local</span><span class="p">)</span>

<span class="c">// func (t Time) In(loc *Location) Time 当前时间对应指定时区的时间</span>
<span class="n">loc</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">LoadLocation</span><span class="p">(</span><span class="s">"America/Los_Angeles"</span><span class="p">)</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span><span class="o">.</span><span class="n">In</span><span class="p">(</span><span class="n">loc</span><span class="p">))</span>

<span class="c">// func (t Time) Local() Time</span>
<span class="n">t</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span><span class="o">.</span><span class="n">Local</span><span class="p">()</span>
</code></pre></div></div><h4 id="格式化">格式化</h4><h5 id="to-string">to string</h5><p>格式化为字符串我们需要使用 <code class="language-plaintext highlighter-rouge">time.Format</code> 方法来转换成我们想要的格式</p><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span><span class="o">.</span><span class="n">Format</span><span class="p">(</span><span class="s">"2006-01-02 15:04:05"</span><span class="p">))</span>  <span class="c">// 2018-04-24 10:11:20</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span><span class="o">.</span><span class="n">Format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">UnixDate</span><span class="p">))</span>         <span class="c">// Tue Apr 24 09:59:02 CST 2018</span>
</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">Format</code> 函数中可以指定你想使用的格式，同时 <code class="language-plaintext highlighter-rouge">time</code> 包中也给了一些我们常用的格式</p><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="p">(</span>
    <span class="n">ANSIC</span>       <span class="o">=</span> <span class="s">"Mon Jan _2 15:04:05 2006"</span>
    <span class="n">UnixDate</span>    <span class="o">=</span> <span class="s">"Mon Jan _2 15:04:05 MST 2006"</span>
    <span class="n">RubyDate</span>    <span class="o">=</span> <span class="s">"Mon Jan 02 15:04:05 -0700 2006"</span>
    <span class="n">RFC822</span>      <span class="o">=</span> <span class="s">"02 Jan 06 15:04 MST"</span>
    <span class="n">RFC822Z</span>     <span class="o">=</span> <span class="s">"02 Jan 06 15:04 -0700"</span> <span class="c">// RFC822 with numeric zone</span>
    <span class="n">RFC850</span>      <span class="o">=</span> <span class="s">"Monday, 02-Jan-06 15:04:05 MST"</span>
    <span class="n">RFC1123</span>     <span class="o">=</span> <span class="s">"Mon, 02 Jan 2006 15:04:05 MST"</span>
    <span class="n">RFC1123Z</span>    <span class="o">=</span> <span class="s">"Mon, 02 Jan 2006 15:04:05 -0700"</span> <span class="c">// RFC1123 with numeric zone</span>
    <span class="n">RFC3339</span>     <span class="o">=</span> <span class="s">"2006-01-02T15:04:05Z07:00"</span>
    <span class="n">RFC3339Nano</span> <span class="o">=</span> <span class="s">"2006-01-02T15:04:05.999999999Z07:00"</span>
    <span class="n">Kitchen</span>     <span class="o">=</span> <span class="s">"3:04PM"</span>
    <span class="c">// Handy time stamps.</span>
    <span class="n">Stamp</span>      <span class="o">=</span> <span class="s">"Jan _2 15:04:05"</span>
    <span class="n">StampMilli</span> <span class="o">=</span> <span class="s">"Jan _2 15:04:05.000"</span>
    <span class="n">StampMicro</span> <span class="o">=</span> <span class="s">"Jan _2 15:04:05.000000"</span>
    <span class="n">StampNano</span>  <span class="o">=</span> <span class="s">"Jan _2 15:04:05.000000000"</span>
<span class="p">)</span>
</code></pre></div></div><p><strong>注意</strong>: <code class="language-plaintext highlighter-rouge">galang</code> 中指定的特定时间格式为 <code class="language-plaintext highlighter-rouge">"2006-01-02 15:04:05 -0700 MST"</code>， 为了记忆方便，按照美式时间格式 月日时分秒年 外加时区 排列起来依次是 01/02 03:04:05PM ‘06 -0700，刚开始使用时需要注意。</p><h5 id="to-time-stamp">to time stamp</h5><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="p">(</span><span class="n">t</span> <span class="n">Time</span><span class="p">)</span> <span class="n">Unix</span><span class="p">()</span> <span class="kt">int64</span>
<span class="k">func</span> <span class="p">(</span><span class="n">t</span> <span class="n">Time</span><span class="p">)</span> <span class="n">UnixNano</span><span class="p">()</span> <span class="kt">int64</span>

<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span><span class="o">.</span><span class="n">Unix</span><span class="p">())</span>

<span class="c">// 获取指定日期的时间戳</span>
<span class="n">dt</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="s">"2016-01-02 15:04:05"</span><span class="p">,</span> <span class="s">"2018-04-23 12:24:51"</span><span class="p">)</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">Unix</span><span class="p">())</span>

<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="m">2018</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">15</span><span class="p">,</span><span class="m">30</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="m">0</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">Local</span><span class="p">)</span><span class="o">.</span><span class="n">Unix</span><span class="p">())</span>
</code></pre></div></div><h4 id="其他">其他</h4><p><code class="language-plaintext highlighter-rouge">time</code> 包还提供了一些常用的方法，基本覆盖了大多数业务，从方法名就能知道代表的含义就不一一说明了。</p><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="p">(</span><span class="n">t</span> <span class="n">Time</span><span class="p">)</span> <span class="n">Date</span><span class="p">()</span> <span class="p">(</span><span class="n">year</span> <span class="kt">int</span><span class="p">,</span> <span class="n">month</span> <span class="n">Month</span><span class="p">,</span> <span class="n">day</span> <span class="kt">int</span><span class="p">)</span>
<span class="k">func</span> <span class="p">(</span><span class="n">t</span> <span class="n">Time</span><span class="p">)</span> <span class="n">Clock</span><span class="p">()</span> <span class="p">(</span><span class="n">hour</span><span class="p">,</span> <span class="n">min</span><span class="p">,</span> <span class="n">sec</span> <span class="kt">int</span><span class="p">)</span>
<span class="k">func</span> <span class="p">(</span><span class="n">t</span> <span class="n">Time</span><span class="p">)</span> <span class="n">Year</span><span class="p">()</span> <span class="kt">int</span>
<span class="k">func</span> <span class="p">(</span><span class="n">t</span> <span class="n">Time</span><span class="p">)</span> <span class="n">Month</span><span class="p">()</span> <span class="n">Month</span>
<span class="k">func</span> <span class="p">(</span><span class="n">t</span> <span class="n">Time</span><span class="p">)</span> <span class="n">Day</span><span class="p">()</span> <span class="kt">int</span>
<span class="k">func</span> <span class="p">(</span><span class="n">t</span> <span class="n">Time</span><span class="p">)</span> <span class="n">Hour</span><span class="p">()</span> <span class="kt">int</span>
<span class="k">func</span> <span class="p">(</span><span class="n">t</span> <span class="n">Time</span><span class="p">)</span> <span class="n">Minute</span><span class="p">()</span> <span class="kt">int</span>
<span class="k">func</span> <span class="p">(</span><span class="n">t</span> <span class="n">Time</span><span class="p">)</span> <span class="n">Second</span><span class="p">()</span> <span class="kt">int</span>
<span class="k">func</span> <span class="p">(</span><span class="n">t</span> <span class="n">Time</span><span class="p">)</span> <span class="n">Nanosecond</span><span class="p">()</span> <span class="kt">int</span>
<span class="k">func</span> <span class="p">(</span><span class="n">t</span> <span class="n">Time</span><span class="p">)</span> <span class="n">YearDay</span><span class="p">()</span> <span class="kt">int</span>
<span class="k">func</span> <span class="p">(</span><span class="n">t</span> <span class="n">Time</span><span class="p">)</span> <span class="n">Weekday</span><span class="p">()</span> <span class="n">Weekday</span>
<span class="k">func</span> <span class="p">(</span><span class="n">t</span> <span class="n">Time</span><span class="p">)</span> <span class="n">ISOWeek</span><span class="p">()</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">week</span> <span class="kt">int</span><span class="p">)</span>
<span class="k">func</span> <span class="p">(</span><span class="n">t</span> <span class="n">Time</span><span class="p">)</span> <span class="n">IsZero</span><span class="p">()</span> <span class="kt">bool</span>
<span class="k">func</span> <span class="p">(</span><span class="n">t</span> <span class="n">Time</span><span class="p">)</span> <span class="n">Local</span><span class="p">()</span> <span class="n">Time</span>
<span class="k">func</span> <span class="p">(</span><span class="n">t</span> <span class="n">Time</span><span class="p">)</span> <span class="n">Location</span><span class="p">()</span> <span class="o">*</span><span class="n">Location</span>
<span class="k">func</span> <span class="p">(</span><span class="n">t</span> <span class="n">Time</span><span class="p">)</span> <span class="n">Zone</span><span class="p">()</span> <span class="p">(</span><span class="n">name</span> <span class="kt">string</span><span class="p">,</span> <span class="n">offset</span> <span class="kt">int</span><span class="p">)</span>
<span class="k">func</span> <span class="p">(</span><span class="n">t</span> <span class="n">Time</span><span class="p">)</span> <span class="n">Unix</span><span class="p">()</span> <span class="kt">int64</span>
</code></pre></div></div><h3 id="时间段-duartion">时间段 (Duartion)</h3><p>介绍完了时间点，我们再来介绍时间段，即 <code class="language-plaintext highlighter-rouge">Duartion</code> 类型， 我们业务也是很常用的类型。</p><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// func ParseDuration(s string) (Duration, error)</span>
<span class="n">tp</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">ParseDuration</span><span class="p">(</span><span class="s">"1.5s"</span><span class="p">)</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">tp</span><span class="o">.</span><span class="n">Truncate</span><span class="p">(</span><span class="m">1000</span><span class="p">),</span> <span class="n">tp</span><span class="o">.</span><span class="n">Seconds</span><span class="p">(),</span> <span class="n">tp</span><span class="o">.</span><span class="n">Nanoseconds</span><span class="p">())</span>

<span class="k">func</span> <span class="p">(</span><span class="n">d</span> <span class="n">Duration</span><span class="p">)</span> <span class="n">Hours</span><span class="p">()</span> <span class="kt">float64</span>
<span class="k">func</span> <span class="p">(</span><span class="n">d</span> <span class="n">Duration</span><span class="p">)</span> <span class="n">Minutes</span><span class="p">()</span> <span class="kt">float64</span>
<span class="k">func</span> <span class="p">(</span><span class="n">d</span> <span class="n">Duration</span><span class="p">)</span> <span class="n">Seconds</span><span class="p">()</span> <span class="kt">float64</span>
<span class="k">func</span> <span class="p">(</span><span class="n">d</span> <span class="n">Duration</span><span class="p">)</span> <span class="n">Nanoseconds</span><span class="p">()</span> <span class="kt">int64</span>
<span class="k">func</span> <span class="p">(</span><span class="n">d</span> <span class="n">Duration</span><span class="p">)</span> <span class="n">Round</span><span class="p">(</span><span class="n">m</span> <span class="n">Duration</span><span class="p">)</span> <span class="n">Duration</span>         <span class="c">// 四舍五入</span>
<span class="k">func</span> <span class="p">(</span><span class="n">d</span> <span class="n">Duration</span><span class="p">)</span> <span class="n">Truncate</span><span class="p">(</span><span class="n">m</span> <span class="n">Duration</span><span class="p">)</span> <span class="n">Duration</span>      <span class="c">// 向下取整</span>
</code></pre></div></div><h3 id="时区-location">时区 (Location)</h3><p>我们在来介绍一下时区的相关的函数</p><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// 默认UTC    </span>
<span class="n">loc</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">LoadLocation</span><span class="p">(</span><span class="s">""</span><span class="p">)</span> 
<span class="c">// 服务器设定的时区，一般为CST</span>
<span class="n">loc</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">LoadLocation</span><span class="p">(</span><span class="s">"Local"</span><span class="p">)</span>
<span class="c">// 美国洛杉矶PDT</span>
<span class="n">loc</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">LoadLocation</span><span class="p">(</span><span class="s">"America/Los_Angeles"</span><span class="p">)</span>

<span class="c">// 获取指定时区的时间点</span>
<span class="n">local</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">LoadLocation</span><span class="p">(</span><span class="s">"America/Los_Angeles"</span><span class="p">)</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="m">2018</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">12</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span> <span class="n">local</span><span class="p">))</span>
</code></pre></div></div><p>可以在 <code class="language-plaintext highlighter-rouge">$GOROOT/lib/time/zoneinfo.zip</code> 文件下看到所有时区。</p><h3 id="时间运算">时间运算</h3><p>好了，基础的类型我们介绍完，现在开始时间运算相关的函数，也是日常业务中我们大量应用的。</p><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// func Sleep(d Duration)   休眠多少时间，休眠时处于阻塞状态，后续程序无法执行</span>
<span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="m">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">)</span>

<span class="c">// func After(d Duration) &lt;-chan Time  非阻塞,可用于延迟</span>
<span class="n">time</span><span class="o">.</span><span class="n">After</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="m">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">)</span>

<span class="c">// func Since(t Time) Duration 两个时间点的间隔</span>
<span class="n">start</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Since</span><span class="p">(</span><span class="n">start</span><span class="p">))</span>   <span class="c">// 等价于 Now().Sub(t)， 可用来计算一段业务的消耗时间</span>

<span class="k">func</span> <span class="n">Until</span><span class="p">(</span><span class="n">t</span> <span class="n">Time</span><span class="p">)</span> <span class="n">Duration</span>     <span class="c">//  等价于 t.Sub(Now())，t与当前时间的间隔</span>

<span class="c">// func (t Time) Add(d Duration) Time</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="m">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">))</span>   <span class="c">// 加</span>

<span class="k">func</span> <span class="p">(</span><span class="n">t</span> <span class="n">Time</span><span class="p">)</span> <span class="n">Sub</span><span class="p">(</span><span class="n">u</span> <span class="n">Time</span><span class="p">)</span> <span class="n">Duration</span>                    <span class="c">// 减 </span>

<span class="c">// func (t Time) AddDate(years int, months int, days int) Time</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">AddDate</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">))</span>

<span class="c">// func (t Time) Before(u Time) bool</span>
<span class="c">// func (t Time) After(u Time) bool</span>
<span class="c">// func (t Time) Equal(u Time) bool          比较时间点时尽量使用Equal函数</span>
</code></pre></div></div><h3 id="使用场景">使用场景</h3><h4 id="日期时间差">日期时间差</h4><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dt1</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="m">2018</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">Local</span><span class="p">)</span>
<span class="n">dt2</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="m">2018</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">23</span><span class="p">,</span> <span class="m">59</span><span class="p">,</span> <span class="m">22</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">Local</span><span class="p">)</span>
<span class="c">// 不用关注时区，go会转换成时间戳进行计算</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">dt1</span><span class="o">.</span><span class="n">Sub</span><span class="p">(</span><span class="n">dt2</span><span class="p">))</span>
</code></pre></div></div><h4 id="基于当前时间的前后运算">基于当前时间的前后运算</h4><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">now</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span>

<span class="c">// 一年零一个月一天之后</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span>
<span class="c">// 一段时间之后</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="m">10</span><span class="p">)</span><span class="o">*</span><span class="n">time</span><span class="o">.</span><span class="n">Minute</span><span class="p">))</span>

<span class="c">// 计算两个时间点的相差天数</span>
<span class="n">dt1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">dt1</span><span class="o">.</span><span class="n">Year</span><span class="p">(),</span> <span class="n">dt1</span><span class="o">.</span><span class="n">Month</span><span class="p">(),</span> <span class="n">dt1</span><span class="o">.</span><span class="n">Day</span><span class="p">(),</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">Local</span><span class="p">)</span>
<span class="n">dt2</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">dt2</span><span class="o">.</span><span class="n">Year</span><span class="p">(),</span> <span class="n">dt2</span><span class="o">.</span><span class="n">Month</span><span class="p">(),</span> <span class="n">dt2</span><span class="o">.</span><span class="n">Day</span><span class="p">(),</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">Local</span><span class="p">)</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">Ceil</span><span class="p">(</span><span class="n">dt1</span><span class="o">.</span><span class="n">Sub</span><span class="p">(</span><span class="n">dt2</span><span class="p">)</span><span class="o">.</span><span class="n">Hours</span><span class="p">()</span> <span class="o">/</span> <span class="m">24</span><span class="p">)))</span>
</code></pre></div></div><h4 id="时区转换">时区转换</h4><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// time.Local 用来表示当前服务器时区</span>
<span class="c">// 自定义地区时间</span>
<span class="n">secondsEastOfUTC</span> <span class="o">:=</span> <span class="kt">int</span><span class="p">((</span><span class="m">8</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Hour</span><span class="p">)</span><span class="o">.</span><span class="n">Seconds</span><span class="p">())</span>
<span class="n">beijing</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">FixedZone</span><span class="p">(</span><span class="s">"Beijing Time"</span><span class="p">,</span> <span class="n">secondsEastOfUTC</span><span class="p">)</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="m">2018</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span> <span class="n">beijing</span><span class="p">))</span>  <span class="c">// 2018-01-02 00:00:00 +0800 Beijing Time  </span>

<span class="c">// 当前时间转为指定时区时间</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span><span class="o">.</span><span class="n">In</span><span class="p">(</span><span class="n">beijing</span><span class="p">))</span>

<span class="c">// 指定时间转换成指定时区对应的时间</span>
<span class="n">dt</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">ParseInLocation</span><span class="p">(</span><span class="s">"2006-01-02 15:04:05"</span><span class="p">,</span> <span class="s">"2017-05-11 14:06:06"</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">Local</span><span class="p">)</span>

<span class="c">// 当前时间在零时区年月日   时分秒  时区</span>
<span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">day</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span><span class="o">.</span><span class="n">UTC</span><span class="p">()</span><span class="o">.</span><span class="n">Date</span><span class="p">()</span>     <span class="c">// 2018 April 24 </span>
<span class="n">hour</span><span class="p">,</span> <span class="n">min</span><span class="p">,</span> <span class="n">sec</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span><span class="o">.</span><span class="n">UTC</span><span class="p">()</span><span class="o">.</span><span class="n">Clock</span><span class="p">()</span>    <span class="c">// 3 47 15</span>
<span class="n">zone</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span><span class="o">.</span><span class="n">UTC</span><span class="p">()</span><span class="o">.</span><span class="n">Zone</span><span class="p">()</span>            <span class="c">// UTC</span>
</code></pre></div></div><h4 id="比较两个时间点">比较两个时间点</h4><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dt</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="m">2018</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">Local</span><span class="p">)</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span><span class="o">.</span><span class="n">After</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>     <span class="c">// true</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span><span class="o">.</span><span class="n">Before</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>    <span class="c">// false</span>

<span class="c">// 是否相等 判断两个时间点是否相等时推荐使用 Equal 函数</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()))</span>
</code></pre></div></div><h4 id="设置执行时间">设置执行时间</h4><p>通过 <code class="language-plaintext highlighter-rouge">time.After</code> 函数与 <code class="language-plaintext highlighter-rouge">select</code> 结合使用可用于处理程序超时设定</p><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="p">{</span>
  <span class="k">case</span> <span class="n">m</span> <span class="o">:=</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="o">:</span>
    <span class="c">// do something</span>
  <span class="k">case</span> <span class="o">&lt;-</span> <span class="n">time</span><span class="o">.</span><span class="n">After</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="o">*</span><span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">)</span><span class="o">:</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"time out"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div><h4 id="ticker-类型">Ticker 类型</h4><p><code class="language-plaintext highlighter-rouge">Ticker</code> 类型包含一个 <code class="language-plaintext highlighter-rouge">channel</code> ，有时我们会遇到每隔一段时间执行的业务 (比如设置心跳时间等)，就可以用它来处理，这是一个重复的过程</p><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// 无法取消</span>
<span class="n">tick</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">Tick</span><span class="p">(</span><span class="m">1</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Minute</span><span class="p">)</span>
<span class="k">for</span> <span class="n">_</span> <span class="o">=</span> <span class="k">range</span> <span class="n">tick</span> <span class="p">{</span>
  <span class="c">// do something</span>
<span class="p">}</span>

<span class="c">// 可通过调用ticker.Stop取消</span>
<span class="n">ticker</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">NewTicker</span><span class="p">(</span><span class="m">1</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Minute</span><span class="p">)</span>
<span class="k">for</span> <span class="n">_</span> <span class="o">=</span> <span class="k">range</span> <span class="n">tick</span> <span class="p">{</span>
  <span class="c">// do something</span>
<span class="p">}</span>
</code></pre></div></div><h4 id="timer-类型">Timer 类型</h4><p><code class="language-plaintext highlighter-rouge">Timer</code> 类型用来代表一个单独的事件，当设置的时间过期后，发送当前的时间到 <code class="language-plaintext highlighter-rouge">channel</code>, 我们可以通过以下两种方式来创建</p><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">AfterFunc</span><span class="p">(</span><span class="n">d</span> <span class="n">Duration</span><span class="p">,</span> <span class="n">f</span> <span class="k">func</span><span class="p">())</span> <span class="o">*</span><span class="n">Timer</span>   <span class="c">// 指定一段时间后指定的函数</span>
<span class="k">func</span> <span class="n">NewTimer</span><span class="p">(</span><span class="n">d</span> <span class="n">Duration</span><span class="p">)</span> <span class="o">*</span><span class="n">Timer</span>     
</code></pre></div></div><p>以上两函数都可以使用 <code class="language-plaintext highlighter-rouge">Reset</code>, 这个有个需要注意的地方是使用 <code class="language-plaintext highlighter-rouge">Reset</code> 时需要确保 <code class="language-plaintext highlighter-rouge">t.C</code> 通道被释放时才能调用，以防止发生资源竞争的问题，可通过以下方式解决</p><div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="o">!</span><span class="n">t</span><span class="o">.</span><span class="n">Stop</span><span class="p">()</span> <span class="p">{</span>
  <span class="o">&lt;-</span><span class="n">t</span><span class="o">.</span><span class="n">C</span>
<span class="p">}</span>
<span class="n">t</span><span class="o">.</span><span class="n">Reset</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</code></pre></div></div><h2 id="template">template</h2><h2 id="sync">sync</h2><h2 id="content">content</h2><div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"><h3>文档信息</h3><ul><li>本文作者：<a href="https://lewinz.org" target="_blank">Lewin</a></li><li>本文链接：<a href="https://lewinz.org/2021/06/24/golang-basic-package/" target="_blank">https://lewinz.org/2021/06/24/golang-basic-package/</a></li><li>版权声明：自由转载-非商用-非衍生-保持署名</li></ul></div></article><div class="share"></div><div class="comment"><div id="gitalk-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/vendor/gitalk/gitalk.css"> <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> <script> var gitalk = new Gitalk({ id: '/2021/06/24/golang-basic-package/', clientID: '3e7199ec0cac88c1d311', clientSecret: '55eef1180649f1417aa979dc9f50f66ed4a6e69a', repo: 'blog-comments', owner: 'Lewinz', admin: ['Lewinz'], labels: ['gitment'], perPage: 50, }); gitalk.render('gitalk-container'); </script></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width:96%" type="text" id="search_box" placeholder="Search"></div><ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul><script src="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: 'https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@built/assets/search_data.json?v=1624546502', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 10, fuzzy: false, exclude: ['Welcome'] }) </script><h3 class="post-directory-title mobile-hidden">Table of Contents</h3><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/js/jquery.toc.js"></script></div></div></section><footer class="container"> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7093222719567591" data-ad-slot="5263168187" data-ad-format="auto" data-full-width-responsive="true"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2021 <span title="Lewin">Lewin</span> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo(0,0)" >TOP</a></li></ul><a href="https://github.com/Lewinz/lewinz.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="https://lewinz.org/" title="首页" target="">首页</a></li><li> <a href="https://lewinz.org/categories/" title="分类" target="">分类</a></li><li> <a href="https://lewinz.org/wiki/" title="维基" target="">维基</a></li><li> <a href="https://lewinz.org/links/" title="链接" target="">链接</a></li><li> <a href="https://lewinz.org/about/" title="关于" target="">关于</a></li><li><a href="https://lewinz.org/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul><script async src="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/vendor/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="mobile-hidden" style="margin-top:8px"> <span id="busuanzi_container_site_pv" style="display:none"> 本站访问量<span id="busuanzi_value_site_pv"></span>次 </span> <span id="busuanzi_container_site_uv" style="display:none"> / 本站访客数<span id="busuanzi_value_site_uv"></span>人 </span> <span id="busuanzi_container_page_pv" style="display:none"> / 本页访问量<span id="busuanzi_value_page_pv"></span>次 / 统计始于2021-04-21 </span></div></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a></div><script src="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script><div style="display:none"> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-80669434-1', 'auto'); ga('send', 'pageview'); </script></div></body></html>
