<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>OpenStack 社区部署工具 Devstack &mdash; 阿嫂</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/css/components/collection.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/css/components/repo-card.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/css/sections/repo-list.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/css/components/boxed-group.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/css/globals/common.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/css/globals/responsive.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/css/posts/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/rouge-themes@master/dist/github.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/vendor/share.js/dist/css/share.min.css"><link rel="canonical" href="https://lewinz.org/2021/07/26/openstack-devstack/"><link rel="alternate" type="application/atom+xml" title="阿嫂" href="https://lewinz.org/feed.xml"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/favicon.ico"><meta property="og:title" content="OpenStack 社区部署工具 Devstack"><meta name="keywords" content="openstack, devstack"><meta name="og:keywords" content="openstack, devstack"><meta name="description" content="为什么需要 DevstackOpenStack 是一个十分复杂的分布式系统，部署难度较大，调试也较困难。"><meta name="og:description" content="为什么需要 DevstackOpenStack 是一个十分复杂的分布式系统，部署难度较大，调试也较困难。"><meta property="og:url" content="https://lewinz.org/2021/07/26/openstack-devstack/"><meta property="og:site_name" content="阿嫂"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2021-07-26"> <script src="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/js/jquery-ui.js"></script> <script src="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/js/main.js"></script> <script data-ad-client="ca-pub-7093222719567591" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1><a href="https://lewinz.org/" title="阿嫂"><span class="octicon octicon-mark-github"></span> 阿嫂</a></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="https://lewinz.org/" class=" site-header-nav-item" target="" title="首页">首页</a> <a href="https://lewinz.org/categories/" class=" site-header-nav-item" target="" title="分类">分类</a> <a href="https://lewinz.org/wiki/" class=" site-header-nav-item" target="" title="维基">维基</a> <a href="https://lewinz.org/links/" class=" site-header-nav-item" target="" title="链接">链接</a> <a href="https://lewinz.org/about/" class=" site-header-nav-item" target="" title="关于">关于</a></nav></div></header><section class="collection-head small geopattern" data-pattern-id="OpenStack 社区部署工"><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">OpenStack 社区部署工具 Devstack</h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2021/07/26 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://lewinz.org/categories/#openstack" title="openstack">openstack</a> </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://lewinz.org/categories/#devstack" title="devstack">devstack</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 6303 字，约 19 分钟 </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths" > <ins class="adsbygoogle content-header-ad" data-ad-client="ca-pub-7093222719567591" data-ad-slot="1650902835"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> <br /><article class="article-content markdown-body"><h2 id="为什么需要-devstack">为什么需要 Devstack</h2><p><code class="language-plaintext highlighter-rouge">OpenStack</code> 是一个十分复杂的分布式系统，部署难度较大，调试也较困难。</p><p>对于开发者，首先需要一个 <code class="language-plaintext highlighter-rouge">allinone</code> 的开发环境，可以随时修改代码并查看结果。各大厂商的部署工具一般都支持 <code class="language-plaintext highlighter-rouge">allinone</code> 的快速部署，比如红帽的 <code class="language-plaintext highlighter-rouge">RDO</code> 工具等。</p><p>不过这些厂商的代码包通常是随着 <code class="language-plaintext highlighter-rouge">OpenStack</code> 的大版本发布而更新，不能实时与社区代码同步，而对于开发者而言，往往需要的是最新的代码，精确到最新的一次 <code class="language-plaintext highlighter-rouge">commit</code> ，因此使用厂商提供的部署工具难以满足开发需求。</p><p>幸运的是社区已经提供了现成的快速部署工具，即 <code class="language-plaintext highlighter-rouge">DevStack(Develop OpenStack)</code> ，从英文名称上也能看出这是专为开发 <code class="language-plaintext highlighter-rouge">OpenStack</code> 量身打造的工具。</p><p><code class="language-plaintext highlighter-rouge">DevStack</code> 不依赖于任何自动化部署工具，纯 <code class="language-plaintext highlighter-rouge">Bash</code> 脚本实现，因此不需要花费大量时间耗在部署工具准备上，而只需要简单地编辑配置文件，然后运行脚本即可实现一键部署 <code class="language-plaintext highlighter-rouge">OpenStack</code> 环境。利用 <code class="language-plaintext highlighter-rouge">DevStack</code> 基本可以部署所有的 <code class="language-plaintext highlighter-rouge">OpenStack</code> 组件，但并不是所有的开发者都需要部署所有的服务，比如 <code class="language-plaintext highlighter-rouge">Nova</code> 开发者可能只需要部署核心组件就够了，其它服务比如 <code class="language-plaintext highlighter-rouge">Swift</code>、<code class="language-plaintext highlighter-rouge">Heat</code>、<code class="language-plaintext highlighter-rouge">Sahara</code> 等其实并不需要。<code class="language-plaintext highlighter-rouge">DevStack</code> 充分考虑这种情况，一开始的设计就是可扩展的，除了核心组件，其它组件都是以插件的形式提供，开发者只需要根据自己的需求定制配置自己的插件即可。</p><p><code class="language-plaintext highlighter-rouge">DevStack</code> 除了给开发者快速部署最新的 <code class="language-plaintext highlighter-rouge">OpenStack</code> 开发环境，社区项目的功能测试也是通过 <code class="language-plaintext highlighter-rouge">DevStack</code> 完成，开发者提交的代码在合并到主分支之前，必须通过 <code class="language-plaintext highlighter-rouge">DevStack</code> 的所有功能集测试。另外，前面提到 <code class="language-plaintext highlighter-rouge">DevStack</code> 是基于代码仓库的 <code class="language-plaintext highlighter-rouge">master</code> 分支部署，如果你想尝试 <code class="language-plaintext highlighter-rouge">OpenStack</code> 的最新功能或者新项目，也可以通过 <code class="language-plaintext highlighter-rouge">DevStack</code> 工具快速部署最新代码的测试环境。</p><h2 id="三步玩转-devstack">三步玩转 DevStack</h2><p>刚刚提到 <code class="language-plaintext highlighter-rouge">DevStack</code> 的强大之处，是不是“蠢蠢欲动”想要小试牛刀？不过在开始之前，我得友情提醒下，<code class="language-plaintext highlighter-rouge">DevStack</code> 运行后会安装大量 <code class="language-plaintext highlighter-rouge">OpenStack</code> 依赖的软件包和 <code class="language-plaintext highlighter-rouge">Python</code> 库，如果你怕弄乱你的系统，建议开一个虚拟机（你说用容器？<code class="language-plaintext highlighter-rouge">you can，you up</code>)，在虚拟机里跑 <code class="language-plaintext highlighter-rouge">DevStack</code> 就不用担心会弄坏你的系统了。目前 <code class="language-plaintext highlighter-rouge">DevStack</code> 支持<code class="language-plaintext highlighter-rouge">Ubuntu 14.04/16.04</code>、<code class="language-plaintext highlighter-rouge">Fedora 23/24</code>、<code class="language-plaintext highlighter-rouge">CentOS/RHEL 7</code>以及 <code class="language-plaintext highlighter-rouge">Debian</code> 和 <code class="language-plaintext highlighter-rouge">OpenSUSE</code> 操作系统，不过官方建议使用 <code class="language-plaintext highlighter-rouge">Ubuntu 16.04</code>，因为该操作系统社区测试最全面，出现的问题最少。 OK，让我们开始一步步走起吧。</p><h3 id="创建-stack-用户">创建 stack 用户</h3><p>为了系统的安全， <code class="language-plaintext highlighter-rouge">DevStack</code> 最好不要在 <code class="language-plaintext highlighter-rouge">root</code> 用户下直接运行，因此需要创建一个专门的用户 <code class="language-plaintext highlighter-rouge">stack</code> ，该用户需要有免密码 <code class="language-plaintext highlighter-rouge">sudo</code> 权限，配置如下:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>adduser stack
<span class="nb">echo</span> <span class="s2">"stack ALL=(ALL) NOPASSWD: ALL"</span> <span class="o">&gt;&gt;</span> /etc/sudoers <span class="c"># 建议使用 visudo</span>
su stack
</code></pre></div></div><p>如果已经下载了 <code class="language-plaintext highlighter-rouge">DevStack</code> 代码， <code class="language-plaintext highlighter-rouge">DevStack</code> 也提供了一个专门的脚本创建 <code class="language-plaintext highlighter-rouge">stack</code> 用户，该脚本位于<code class="language-plaintext highlighter-rouge">devstack/tools/create-stack-user.sh</code>，直接运行该脚本即可。<br /> 最后请务必检查当前工作用户为 <code class="language-plaintext highlighter-rouge">stack</code> ，并且能够不输入密码执行 <code class="language-plaintext highlighter-rouge">sudo</code> 命令。</p><h3 id="配置-devstack">配置 DevStack</h3><p>在 <code class="language-plaintext highlighter-rouge">DevStack</code> 根目录下创建 <code class="language-plaintext highlighter-rouge">local.conf</code> 配置文件，包含 <code class="language-plaintext highlighter-rouge">admin</code> 密码、数据库密码、<code class="language-plaintext highlighter-rouge">RabbitMQ</code> 密码以及 <code class="language-plaintext highlighter-rouge">Service</code> 密码：</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[[</span><span class="nb">local</span>|localrc]]
<span class="nv">ADMIN_PASSWORD</span><span class="o">=</span>secret
<span class="nv">DATABASE_PASSWORD</span><span class="o">=</span><span class="nv">$ADMIN_PASSWORD</span>
<span class="nv">RABBIT_PASSWORD</span><span class="o">=</span><span class="nv">$ADMIN_PASSWORD</span>
<span class="nv">SERVICE_PASSWORD</span><span class="o">=</span><span class="nv">$ADMIN_PASSWORD</span>
</code></pre></div></div><p>你也可以直接从 <code class="language-plaintext highlighter-rouge">sample</code> 目录下拷贝一个模板文件，然后在模板文件中修改。 部署一个最简单的 <code class="language-plaintext highlighter-rouge">OpenStack</code> 环境以上配置就够了，是不是特别简单？</p><h3 id="let-devstack-fly">Let DevStack Fly</h3><p><code class="language-plaintext highlighter-rouge">./stack.sh</code></p><p>就这么简单？是的，一键部署，只需要一个命令！接下来你唯一需要做的，就是砌一杯咖啡静静地等待，取决于你的网络，通常需要等待半个小时。部署完后，会输出 <code class="language-plaintext highlighter-rouge">Dashboard</code> 地址以及默认创建的两个账号，一个是管理员账号 <code class="language-plaintext highlighter-rouge">admin</code> ，另一个是普通账号 <code class="language-plaintext highlighter-rouge">demo</code> ，如下：</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>This is your host IP address: 172.16.0.41
This is your host IPv6 address: ::1
Horizon is now available at http://172.16.0.41/dashboard
Keystone is serving at http://172.16.0.41:5000/
The default <span class="nb">users </span>are: admin and demo
The password: secret
</code></pre></div></div><p>注意以上部署的是一个精简版的 <code class="language-plaintext highlighter-rouge">OpenStack</code> 环境，默认只包含核心组件和 <code class="language-plaintext highlighter-rouge">Horizon</code> ，包括 <code class="language-plaintext highlighter-rouge">Keystone</code>、<code class="language-plaintext highlighter-rouge">Glance</code>、<code class="language-plaintext highlighter-rouge">Nova</code>、<code class="language-plaintext highlighter-rouge">Neutron</code>、<code class="language-plaintext highlighter-rouge">Cinder</code>、<code class="language-plaintext highlighter-rouge">Horizon</code> 等，其它服务则需要通过配置文件开启对应的插件完成，将在下面小节介绍。</p><h3 id="关于下载速度优化">关于下载速度优化</h3><p>由于众所周知的原因，运行 <code class="language-plaintext highlighter-rouge">DevStack</code> 时下载 <code class="language-plaintext highlighter-rouge">OpenStack</code> 依赖包和 <code class="language-plaintext highlighter-rouge">Python</code> 库时非常慢，拉取 <code class="language-plaintext highlighter-rouge">OpenStack</code> 源码也非常耗时。为了避免这个问题，很多人都会从以下几个方面优化下载速度，加快部署速率：</p><ol><li>使用国内的镜像源 对于 <code class="language-plaintext highlighter-rouge">Ubuntu</code> 系统就是修改 <code class="language-plaintext highlighter-rouge">APT</code> 源，比如阿里云镜像源，只需要修改 <code class="language-plaintext highlighter-rouge">/etc/apt/source.list</code> 配置文件即可，替换为需要使用的镜像源。如：<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>deb http://mirrors.aliyun.com/ubuntu/ xenial main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ xenial-proposed main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ xenial main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-proposed main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse
</code></pre></div></div></li><li>使用国内的 pip 源 只需要在当前家目录 <code class="language-plaintext highlighter-rouge">.pip</code> 目录创建 <code class="language-plaintext highlighter-rouge">pip.conf</code> 配置文件，以使用阿里云为例，配置文件内容如下： <code class="language-plaintext highlighter-rouge">cat ~/.pip/pip.conf</code><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>global]
index-url <span class="o">=</span> http://mirrors.aliyun.com/pypi/simple/
<span class="o">[</span><span class="nb">install</span><span class="o">]</span>
trusted-host<span class="o">=</span>mirrors.aliyun.com
</code></pre></div></div></li><li>修改 OpenStack 源码地址 <code class="language-plaintext highlighter-rouge">DevStack</code> 默认会从 <code class="language-plaintext highlighter-rouge">git.openstack.org</code> 下拉取代码，国内访问速度很慢，建议替换为 <code class="language-plaintext highlighter-rouge">github</code> 地址或者国内的 <code class="language-plaintext highlighter-rouge">trystack</code> 仓库，在<code class="language-plaintext highlighter-rouge">[[local|localrc]]</code>配置下增加以下配置项： <code class="language-plaintext highlighter-rouge">GIT_BASE=http://git.trystack.cn</code></li></ol><p>如果你本地已经有最新的 <code class="language-plaintext highlighter-rouge">OpenStack</code> 源码了，也可以指定你本地的源码路径，比如使用本地的 <code class="language-plaintext highlighter-rouge">Nova</code> 源代码并且使用 <code class="language-plaintext highlighter-rouge">new_feature</code> 分支:</p><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[[</span><span class="nb">local</span>|localrc]]
<span class="nv">NOVA_REPO</span><span class="o">=</span>/home/int32bit/nova
<span class="nv">NOVA_BRANCH</span><span class="o">=</span>new_feature
</code></pre></div></div><p>需要注意的是，国内源存在同步滞后，可能包不兼容或者下载某些包失败问题，出现这种情况时只需要重新替换原来的镜像源，然后重新运行 <code class="language-plaintext highlighter-rouge">./stack.sh</code> 即可。</p><h2 id="使用-devstack-环境开发">使用 DevStack 环境开发</h2><p><code class="language-plaintext highlighter-rouge">DevStack</code> 使用了 <code class="language-plaintext highlighter-rouge">Linux</code> 的终端复用工具 <code class="language-plaintext highlighter-rouge">screen</code> ，不同的服务运行在不同的 <code class="language-plaintext highlighter-rouge">window</code> 中，<code class="language-plaintext highlighter-rouge">screen</code> 的使用方法可参考官方文档。通常情况下，我们都是针对 <code class="language-plaintext highlighter-rouge">OpenStack</code> 的某个组件进行开发，比如 <code class="language-plaintext highlighter-rouge">Nova</code> ，只需要找到 <code class="language-plaintext highlighter-rouge">Nova</code> 的源码路径，修改对应的源码，然后重启对应的服务即可。比如你修改了 <code class="language-plaintext highlighter-rouge">nova</code> 源码下的 <code class="language-plaintext highlighter-rouge">nova/compute/manager.py</code> 代码，则需要重启 <code class="language-plaintext highlighter-rouge">nova-compute</code> 服务，重启步骤如下：</p><p>使用 <code class="language-plaintext highlighter-rouge">screen -ls</code> 命令查找 <code class="language-plaintext highlighter-rouge">stack session</code>。</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># screen -ls</span>
os3:~&gt; screen <span class="nt">-list</span>
There is a screen on:
   28994.stack     <span class="o">(</span>08/10/2016 09:01:33 PM<span class="o">)</span>        <span class="o">(</span>Detached<span class="o">)</span>
1 Socket <span class="k">in</span> /var/run/screen/S-sdague.
</code></pre></div></div><p>通过<code class="language-plaintext highlighter-rouge">screen -r socket attach</code>到前台运行，其中 <code class="language-plaintext highlighter-rouge">socket</code> 为 <code class="language-plaintext highlighter-rouge">scrren</code> 的名称，以上为 <code class="language-plaintext highlighter-rouge">28994.stack</code> 。<br /> 使用<code class="language-plaintext highlighter-rouge">ctrl-a n</code>和<code class="language-plaintext highlighter-rouge">ctrl-a p</code>遍历 <code class="language-plaintext highlighter-rouge">windows</code> ，直到找到 <code class="language-plaintext highlighter-rouge">nova-compute</code> 服务。<br /> 使用<code class="language-plaintext highlighter-rouge">ctrl-c</code>杀掉<code class="language-plaintext highlighter-rouge">nova-compute</code>进程。<br /> 使用上下方向键遍历历史命令，找到跑 <code class="language-plaintext highlighter-rouge">nova-compute</code> 服务的命令，重新运行即可。</p><p>有些服务跑在 <code class="language-plaintext highlighter-rouge">Web</code> 服务器中，比如 <code class="language-plaintext highlighter-rouge">Keystone</code> 服务，此时重启 <code class="language-plaintext highlighter-rouge">Keystone</code> 服务只需要重启 <code class="language-plaintext highlighter-rouge">Apache</code> 服务即可。<br /> 如果你需要修改 <code class="language-plaintext highlighter-rouge">oslo</code> 代码或者 <code class="language-plaintext highlighter-rouge">python-xxxclient</code> 代码就相对麻烦点，因为这些代码不同于 <code class="language-plaintext highlighter-rouge">OpenStack</code> 源码，它默认不是从代码仓库中拉取，而是从已发布的 <code class="language-plaintext highlighter-rouge">pypi</code> 仓库中直接安装。你需要覆盖默认配置，手动配置代码仓库源:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[[</span><span class="nb">local</span>|localrc]]
<span class="nv">LIBS_FROM_GIT</span><span class="o">=</span>oslo.policy
<span class="nv">OSLOPOLICY_REPO</span><span class="o">=</span>/home/sdague/oslo.policy
<span class="nv">OSLOPOLICY_BRANCH</span><span class="o">=</span>better_exception
</code></pre></div></div><p>由于这些公共库需要被许多不同的项目依赖，因此社区的推荐做法是需要重新部署整个 <code class="language-plaintext highlighter-rouge">DevStack</code> 环境:<br /> <code class="language-plaintext highlighter-rouge">./unstack.sh &amp;&amp; ./stack.sh</code> 这个过程虽然不用重复从网络上下载包，相比第一次部署节省了不少时间，但仍然还是挺耗时间的，不利于单步调试。个人更倾向于改什么就重启什么服务，比如我修改了 <code class="language-plaintext highlighter-rouge">oslo.db</code> 代码，并且主要是解决 <code class="language-plaintext highlighter-rouge">Nova</code> 问题，那我只需要重启 <code class="language-plaintext highlighter-rouge">Nova</code> 服务即可，暂时不需要重新部署整个 <code class="language-plaintext highlighter-rouge">DevStack</code> 。而若修改了 <code class="language-plaintext highlighter-rouge">client</code> 代码，不需要重启任何服务，直接就可以测试功能。当然这种方式没有考虑其它服务的依赖，可能引入新问题，因此在确定开发完成后，最好还是完完全全走一遍 <code class="language-plaintext highlighter-rouge">unstack</code> 、 <code class="language-plaintext highlighter-rouge">stack</code> 流程。</p><h2 id="使用-devstack-部署其它-openstack-服务">使用 DevStack 部署其它 OpenStack 服务</h2><p>前面我们使用 <code class="language-plaintext highlighter-rouge">DevStack</code> 部署了一个精简版的 <code class="language-plaintext highlighter-rouge">OpenStack</code> 环境，其中只包含了几个核心组件。其它 <code class="language-plaintext highlighter-rouge">OpenStack</code> 服务是通过插件形式安装， <code class="language-plaintext highlighter-rouge">DevStack</code> 支持部署的所有插件列表可参考 <code class="language-plaintext highlighter-rouge">DevStack Plugin Registry</code> ，截至 2017 年 2 月份，<code class="language-plaintext highlighter-rouge">DevStack</code> 共包含 132 个安装插件。其中包含：</p><ul><li>trove: 数据库服务。</li><li>sahara: 大数据服务。</li><li>ironic: 裸机服务。</li><li>magnum: 容器编排服务。</li><li>manila: 文件共享服务。</li><li>cloudkitty: 计费服务。 …</li></ul><p>需要开启部署某个服务，只需要使用 <code class="language-plaintext highlighter-rouge">enable_plugin</code> 配置指定对应插件即可，该配置项语法为:<br /> <code class="language-plaintext highlighter-rouge">enable_plugin plugin_name [code repo]</code></p><p>其中 <code class="language-plaintext highlighter-rouge">plugin_name</code> 为插件名称，可以在插件列表中找到，<code class="language-plaintext highlighter-rouge">code repo</code> 为代码仓库地址，不配置就使用默认的地址。<br /> 比如我们需要开启 <code class="language-plaintext highlighter-rouge">Sahara</code> 服务，只需要在 <code class="language-plaintext highlighter-rouge">local.conf</code> 增加以下配置项:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>enable_plugin sahara https://github.com/openstack/sahara.git
enable_plugin sahara-dashboard https://github.com/openstack/sahara-dashboard.git
</code></pre></div></div><p>注意以上我们同时开启了两个 <code class="language-plaintext highlighter-rouge">Sahara</code> 相关的插件，前者是 <code class="language-plaintext highlighter-rouge">Sahara</code> 插件，而后者是 <code class="language-plaintext highlighter-rouge">dashboard</code> 的 <code class="language-plaintext highlighter-rouge">Sahara</code> 插件，若不配置该插件，在 <code class="language-plaintext highlighter-rouge">dashboard</code> 中将看不到 <code class="language-plaintext highlighter-rouge">Sahara</code> 面板。<br /> 除了 <code class="language-plaintext highlighter-rouge">OpenStack</code> 服务外，<code class="language-plaintext highlighter-rouge">DevStack</code> 还支持其它和 <code class="language-plaintext highlighter-rouge">Openstack</code> 相关的插件，比如默认情况下都是使用本地文件系统存储作为 <code class="language-plaintext highlighter-rouge">OpenStack</code> 存储后端，如果需要测试 <code class="language-plaintext highlighter-rouge">Ceph</code> 后端，则需要开启 <code class="language-plaintext highlighter-rouge">devstack-plugin-ceph</code> 插件，该插件会自动部署一个单节点 <code class="language-plaintext highlighter-rouge">Ceph</code> 集群，然后就可以配置 <code class="language-plaintext highlighter-rouge">Glance</code> 、 <code class="language-plaintext highlighter-rouge">Nova</code> 、 <code class="language-plaintext highlighter-rouge">Cinder</code> 、 <code class="language-plaintext highlighter-rouge">Manila</code> 等服务使用 <code class="language-plaintext highlighter-rouge">Ceph</code> 后端了。</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>enable_plugin devstack-plugin-ceph git://git.openstack.org/openstack/devstack-plugin-ceph
<span class="nv">ENABLE_CEPH_CINDER</span><span class="o">=</span>True     <span class="c"># ceph backend for cinder</span>
<span class="nv">ENABLE_CEPH_GLANCE</span><span class="o">=</span>True     <span class="c"># store images in ceph</span>
<span class="nv">ENABLE_CEPH_C_BAK</span><span class="o">=</span>True      <span class="c"># cinder-backup volumes to ceph</span>
<span class="nv">ENABLE_CEPH_NOVA</span><span class="o">=</span>True       <span class="c"># allow nova to use ceph resources</span>
</code></pre></div></div><h2 id="总结">总结</h2><p>本章首先介绍了 <code class="language-plaintext highlighter-rouge">DevStack</code> 的功能，然后详细介绍了如何使用 <code class="language-plaintext highlighter-rouge">DevStack</code> 快速部署一个 <code class="language-plaintext highlighter-rouge">OpenStack</code> 环境，最后介绍了使用 <code class="language-plaintext highlighter-rouge">DevStack</code> 部署其它 <code class="language-plaintext highlighter-rouge">OpenStack</code> 服务。 <code class="language-plaintext highlighter-rouge">DevStack</code> 项目是由社区维护的、专门为 <code class="language-plaintext highlighter-rouge">OpenStack</code> 开发人员准备的快速部署开发环境的脚本工具，该脚本工具具有非常灵活的扩展性，能够通过配置定制化部署 <code class="language-plaintext highlighter-rouge">OpenStack</code> 服务。除此之外，社区项目的功能测试也是通过 <code class="language-plaintext highlighter-rouge">DevStack</code> 完成的。由此可见，<code class="language-plaintext highlighter-rouge">DevStack</code> 是社区一个非常重要的项目，<code class="language-plaintext highlighter-rouge">DevStack</code> 出现问题不仅影响开发者开发，还将可能导致社区的 <code class="language-plaintext highlighter-rouge">CI</code> 系统奔溃。<code class="language-plaintext highlighter-rouge">DevStack</code> 使用 <code class="language-plaintext highlighter-rouge">Shell</code> 脚本实现，如果想学习 <code class="language-plaintext highlighter-rouge">Shell</code> 编程， <code class="language-plaintext highlighter-rouge">DevStack</code> 源码将是一个很好的学习案例。</p><div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"><h3>文档信息</h3><ul><li>本文作者：<a href="https://lewinz.org" target="_blank">Lewin</a></li><li>本文链接：<a href="https://lewinz.org/2021/07/26/openstack-devstack/" target="_blank">https://lewinz.org/2021/07/26/openstack-devstack/</a></li><li>版权声明：自由转载-非商用-非衍生-保持署名</li></ul></div></article><div class="share"><div class="share-component" data-disabled='qq,weibo,qzone'></div></div><div class="comment"><div id="gitalk-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/vendor/gitalk/gitalk.css"> <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> <script> var gitalk = new Gitalk({ id: '/2021/07/26/openstack-devstack/', clientID: '831a35f6d4f6fc049209', clientSecret: '6e80f9a3e9b50b498553e32179ad3adbd893ab7e', repo: 'blog-comments', owner: 'Lewinz', admin: ['Lewinz'], labels: ['gitment'], perPage: 50, }); gitalk.render('gitalk-container'); </script></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width:96%" type="text" id="search_box" placeholder="Search"></div><ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul><script src="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: 'https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@built/assets/search_data.json?v=1635405699', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 10, fuzzy: false, exclude: ['Welcome'] }) </script><h3 class="post-directory-title mobile-hidden">Table of Contents</h3><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/js/jquery.toc.js"></script></div></div></section><footer class="container"> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7093222719567591" data-ad-slot="5263168187" data-ad-format="auto" data-full-width-responsive="true"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2021 <span title="Lewin">Lewin</span> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo(0,0)" >TOP</a></li></ul><a href="https://github.com/Lewinz/lewinz.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="https://lewinz.org/" title="首页" target="">首页</a></li><li> <a href="https://lewinz.org/categories/" title="分类" target="">分类</a></li><li> <a href="https://lewinz.org/wiki/" title="维基" target="">维基</a></li><li> <a href="https://lewinz.org/links/" title="链接" target="">链接</a></li><li> <a href="https://lewinz.org/about/" title="关于" target="">关于</a></li><li><a href="https://lewinz.org/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul><script async src="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/vendor/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="mobile-hidden" style="margin-top:8px"> <span id="busuanzi_container_site_pv" style="display:none"> 本站访问量<span id="busuanzi_value_site_pv"></span>次 </span> <span id="busuanzi_container_site_uv" style="display:none"> / 本站访客数<span id="busuanzi_value_site_uv"></span>人 </span> <span id="busuanzi_container_page_pv" style="display:none"> / 本页访问量<span id="busuanzi_value_page_pv"></span>次 / 统计始于2021-04-21 </span></div></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a></div><script src="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/vendor/share.js/dist/js/share.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/Lewinz/lewinz.github.io@master/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script><div style="display:none"> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-80669434-1', 'auto'); ga('send', 'pageview'); </script></div></body></html>
